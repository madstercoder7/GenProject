{% extends "base.html" %}
{% block title %}Chat - GenProject{% endblock %}
{% block main_class %}chat-page{% endblock %}

{% block style %}
<style>
    :root {
        --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
    }

    body {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        margin: 0;
        padding: 0;
        height: 100vh;
        overflow: hidden;
    }

    .chat-container {
        display: flex;
        height: 100vh;
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        box-shadow: 0 0 50px rgba(0, 0, 0, 0.1);
    }

    .sidebar {
        width: 300px;
        background: var(--light-color);
        border-right: 1px solid #e9ecef;
        display: flex;
        flex-direction: column;
    }

    .sidebar-header {
        padding: 20px;
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
    }

    .sidebar-header h4 {
        margin: 0 0 5px 0;
        font-size: 18px;
    }

    .sidebar-header .user-info {
        font-size: 14px;
        opacity: 0.9;
    }

    .connection-status {
        padding: 8px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
        margin-top: 10px;
        display: inline-block;
    }

    .status-connected {
        background: rgba(40, 167, 69, 0.2);
        color: var(--success-color);
    }

    .status-disconnected {
        background: rgba(220, 53, 69, 0.2);
        color: var(--danger-color);
    }

    .status-connecting {
        background: rgba(255, 193, 7, 0.2) ;
        color: var(--warning-color);
    }

    .recent-projects {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
    }

    .recent-projects h6 {
        color: var(--dark-color);
        margin-bottom: 15px;
        font-weight: 600;
    }

    .project-item {
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 10px;
        cursor: pointer;
        transition: all 0.2s;
    }

    .project-item:hover {
        border-color: var(--primary-color);
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
    }

    .project-item .topic {
        font-weight: 600;
        color: var(--primary-color);
        font-size: 14px;
        margin-bottom: 4px;
    }

    .project-item .preview {
        font-size: 12px;
        color: #6c757d;
        line-height: 1.3;
        margin-bottom: 4px;
    }

    .project-item .timestamp {
        font-size: 11px;
        color: #abd5bd;
    }

    .chat-main {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .chat-header {
        padding: 20px;
        background: white;
        border-bottom: 1px solid #e9ecef;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .chat-header h3 {
        margin: 0;
        color: var(--primary-color);
        font-size: 24px;
    }

    .chat-messages {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        scroll-behavior: smooth;
        background: #f8f9fa;
    }

    .message {
        margin-bottom: 20px;
        display: flex;
    }

    .message.user-message {
        justify-content: flex-end;
    }

    .message-bubble {
        max-width: 70%;
    }

</style>
{% endblock %}

{% block content %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>

<div class="chat-container">
    <div class="sidebar" id="chatSidebar">
        <div class="sidebar-header">
            <h4><i class="fas fa-lightbulb"></i>GenProject</h4>
            <div class="user-info">{{ user.name }} (@{{user.username }})</div>
            <div class="connection-status status-connecting" id="connectionStatus">
                <i class="fas fa-circle"></i> Connecting...
            </div>
        </div>

        <div class="recent-projects">
            <h6><i class="fas fa-history"></i> Recent Projects</h6>
            {% if recent_projects %}
                {% for project in recent_projects %}
                    <div class="project-item" onclick=`loadProject('{{ project.topic }}', {{ project.id }})`>
                        <div class="topic">{{ project.topic }}</div>
                        <div class="preview">{{ project.content[:100] }} ... </div>
                        <div class="timetsamp">{{ project.timestamp.strftime("%b %d, %Y at %I:%M %p") }}</div>
                    </div>
                {% endfor %}
            {% else %}
                <div class="text-muted">No project yet. Start chatting to create your first project idea!</div>
            {% endif %}

            <div class="mt-3">
                <a href="{{ url_for('generate') }}" class="btn btn-outline-primary btn-sm me-2">
                    <i class="fas fa-list"></i> Classic View
                </a>
                <a href="{{ url_for('logout') }}" class="btn btn-outline-danger btn-sm">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </div>
        </div>
    </div>

    <div class="chat-main">
        <div class="chat-header">
            <h3><i class="fas fa-comments"></i> Project Idea Generator</h3>
            <button class="btn btn-outline-secondary btn-sm sidebar-toggle d-md-none" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
        </div>   

        <div class="chat-messages" id="chatMessages">
            <div class="message bot-message">
                <div class="message-bubble welcome-message">
                    <div><strong>Welcome to GenProject</strong></div>
                    <p>I'm your AI project idea generator. Tell me what technologies, topics, or types of projects you're interested in and I'll help you brainstorm exciting coding projects</p>
                    <div class="suggestions">
                        <button class="suggestion-btn" onclick="sendSuggestion('Web development with React and Node.js')">
                            <i class="fab fa-react"></i> Web Development
                        </button>
                        <button class="suggestion-btn" onclick="sendSuggestion('Machine Learning project with Python')">
                            <i class="fas fa-brain"></i> Machine Learning
                        </button>
                        <button class="suggestion-btn" onclick="sendSuggestion('Mobile App Development')">
                            <i class="fas fa-mobile-alt"></i> Mobile App
                        </button>
                        <button class="suggestion-btn" onclick="sendSuggestion('Data Visualization project')">
                            <i class="fas fa-chart-bar"></i> Data Visualization
                        </button>
                        <button class="suggestion-btn" onclick="sendSuggestion('API Development with Flask')">
                            <i class="fas fa-server"></i> API Development
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
            <div class="typing-dots">
                <span></span><span></span><span></span>
            </div>
            <span>GenProject is thinking... </span>
        </div>

        <div class="chat-input-container">
            <div class="input-wrapper">
                <textarea id="messageInput" placeholder="Describe the type of project you'd like to build..." maxlength="500" rows="1"></textarea>
                <button id="sendButton" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            <div class="input-footer">
                <span class="char-count">0/500</span>
                <span class="hint">Press Enter to send, Shift+Enter for new line</span>
            </div>
        </div>
    </div>    
</div>
{% endblock %}